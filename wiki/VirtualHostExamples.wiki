#summary Examples of using mod_pagespeed on VirtualHosts

By default mod_pagespeed installs itself for the entire Apache server including all [http://httpd.apache.org/docs/current/vhosts/ VirtualHost]s. If you want the exact same configuration for all !VirtualHosts than you can just use the default configuration layout. However, if you want to configure different !VirtualHosts differently, you will need to use a different layout for configuration options. This pages covers some examples of mixed installations on multi-server setups.

= Note =

We're no vhost experts, and wrote this based on reading the [http://httpd.apache.org/docs/current/vhosts/ Apache docs] and experimenting with an example server. Please let us know if any of this doesn't work or if there is a better way of doing it at mod-pagespeed-discuss@googlegroups.com.

= Examples =

The most basic example is just to copy all configuration into each !VirtualHost and turn it off globaly, for example, starting with the !VirtualHost directives from [http://httpd.apache.org/docs/2.0/vhosts/examples.html this VirtualHost examples page]:

{{{
# Ensure that Apache listens on port 80
Listen 80

# Listen for virtual host requests on all IP addresses
NameVirtualHost *:80

<VirtualHost *:80>
  DocumentRoot /www/example1
  ServerName www.example1.com

  # Other directives here
</VirtualHost>

<VirtualHost *:80>
  DocumentRoot /www/example2
  ServerName www.example2.org

  # Other directives here
</VirtualHost>
}}}

If we want to have mod_pagespeed on for www.example2.com, but not www.example1.com, we could change it to:

{{{
# Ensure that Apache listens on port 80
Listen 80

# Listen for virtual host requests on all IP addresses
NameVirtualHost *:80

<VirtualHost *:80>
  DocumentRoot /www/example1
  ServerName www.example1.com

  # Other directives here
</VirtualHost>

<VirtualHost *:80>
  DocumentRoot /www/example2
  ServerName www.example2.org

  # Other directives here

  # Turn on mod_pagespeed. To completely disable mod_pagespeed, you
  # can set this to "off".
  ModPagespeed on

  # The ModPagespeedFileCachePath and
  # ModPagespeedGeneratedFilePrefix directories must exist and be
  # writable by the apache user (as specified by the User directive).
  ModPagespeedFileCachePath            "/usr/local/apache2/pagespeed/cache/"
  ModPagespeedGeneratedFilePrefix      "/usr/local/apache2/pagespeed/files/"

  # Other ModPagespeed directives here ...

  # This page lets you view statistics about the mod_pagespeed module.
  <Location /mod_pagespeed_statistics>
    Order allow,deny
    # You may insert other "Allow from" lines to add hosts you want to
    # allow to look at generated statistics.  Another possibility is
    # to comment out the "Order" and "Allow" options from the config
    # file, to allow any client that can reach your server to examine
    # statistics.  This might be appropriate in an experimental setup or
    # if the Apache server is protected by a reverse proxy that will
    # filter URLs in some fashion.
    Allow from all
    SetHandler mod_pagespeed_statistics
  </Location>
</VirtualHost>
}}}

Notice that we don't copy over {{{AddOutputFilterByType MOD_PAGESPEED_OUTPUT_FILTER text/html}}}, we don't want to add it twice.

Then we, just turn !ModPagespeed off in pagespeed.conf:

{{{
<IfModule pagespeed_module>
    # Turn on mod_pagespeed. To completely disable mod_pagespeed, you
    # can set this to "off".
    ModPagespeed off

    # Direct Apache to send all HTML output to the mod_pagespeed
    # output handler.
    AddOutputFilterByType MOD_PAGESPEED_OUTPUT_FILTER text/html

    # ...
}}}